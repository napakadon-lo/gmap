<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="mrp_data_search_view" model="ir.ui.view">
        <field name="name">mrp.data.search.view</field>
        <field name="model">mrp.data</field>
        <field name="arch" type="xml">
            <search>
                <field name="template_id"/>
                <field name="name"/>
                <field name="date"/>
                <field name="mrp_team_id"/>
                <filter string="Today" domain="[('date', '=', context_today().strftime('%Y-%m-%d'))]" name="today"/>
                <filter string="Todo" domain="[('state', '=', 'draft'),('date', '&lt;=', context_today().strftime('%Y-%m-%d'))]" name="todo"/>
                <filter string="Todo(Today)" domain="[('date', '=', context_today().strftime('%Y-%m-%d')),('state', '=', 'draft')]" name="todotoday"/>
                <filter string="To Approve" domain="[('state', '=', 'confirmed')]" name="toapprove"/>
                <filter string="Done" name="done" domain="[('state','=','done')]"/>
                <group>
                    <!--<filter string="Team" domain="[]" context="{'group_by': 'mrp_team_id'}"/>-->
                    <filter string="Template" domain="[]" context="{'group_by': 'template_id'}"/>
                    <filter string="State" domain="[]" context="{'group_by':'state'}"/>
                    <filter string="Type" domain="[]" context="{'group_by': 'type'}"/>
                    <filter string="Process" domain="[]" context="{'group_by': 'process_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="mrp_data_tree_view" model="ir.ui.view">
        <field name="name">mrp.data.tree.view</field>
        <field name="model">mrp.data</field>
        <field name="arch" type="xml">
            <tree decoration-success="state == 'approved'" decoration-muted="state == 'cancel'" decoration-info='state == "draft"'>
                <field name="date"/>
                <field name="name"/>
                <field name="template_id"/>
                <field name="state"/>
                <field name="process_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="mrp_data_form_view" model="ir.ui.view">
        <field name="name">mrp.data.form.view</field>
        <field name="model">mrp.data</field>
        <field name="arch" type="xml">
            <form>
                <header>

                    <button string="Generate" name="button_gen_template" type="object" context="{'is_button_gen': True}"
                            attrs='{"invisible":[("lines","!=",[])]}'/>

                    <button string="Confirm" name="button_confirm" type="object"
                            attrs='{"invisible":["|",("state","!=", "draft"),("lines","=", [])]}' class="btn-warning"/>

                    <button string="Approve" name="button_approve" type="object" states="confirmed" class="btn-success" groups="ac_ktis_mrp.group_mrp_data_leader"/>
                    <button string="Reject" name="button_reject" class="btn-danger" type="object" states="confirmed" groups="ac_ktis_mrp.group_mrp_data_leader"/>
                    <button string="Set to Draft" name="button_set_draft" type="object" states="done" groups="base.group_no_one"/>

                    <button string="Create Move" name="button_create_move" type="object"
                            attrs='{"invisible":["|","|",("lines","=",[]),("state","!=","draft"),("type","not in",["input","output"])]}'/>

                    <button string="Create Lot" name="button_create_lot" type="object"
                            attrs='{"invisible":["|","|","|",("lines","=",[]),("state","!=","draft"),("type","not in",["input","output"]),("is_create_lot","=",False)]}'/>

                    <button string="Revise Template" name="button_revise_template" type="object"
                            confirm="Are you sure?" groups="base.group_no_one"
                            attrs='{"invisible":["|",("lines","=",[]),("state","!=","draft")]}'/>

                    <button string="Reset Template" name="button_reset_template" type="object"
                            confirm="Are you sure?" groups="base.group_no_one"
                            attrs='{"invisible":["|",("lines","=",[]),("state","!=","draft")]}'/>

                    <button string="Get Value" name="button_get_value" type="object" groups="base.group_no_one"
                            attrs='{"invisible":["|",("lines","=",[])]}'/>


                    <!--<button string="Cancel" name="button_cancel" type="object" states="done" class="btn-danger"/>-->
                    <!--<button string="Reverse Move" name="reverse_move" type="object" class="btn-danger" attrs='{"invisible":[("type","not in",["input","output"])]}'/>-->

                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,done"/>
                </header>
                <!--<sheet>-->
                <div class="oe_title">
                    <h1>
                        <field name="name" readonly="1"/>
                    </h1>
                </div>
                <notebook>
                    <page string="General">
                        <group attrs='{"readonly":["|",("state","!=","new")]}'>
                            <field name="type" invisible="1"/>
                            <field name="mrp_team_default_id" invisible="1"/>
                            <field name="is_report_date" invisible="1" />
                            <field name="is_create_lot" invisible="1" />
                            <field name="is_picking" invisible="1" />
                            <field name="user_id" options='{"no_create":1}' invisible="1" />
                            <group>
                                <field name="template_id" options='{"no_create":1,"no_open":1}' domain='["|",("type","=", type),("mrp_team_id", "=", mrp_team_default_id)]' attrs='{"readonly":["|",("state","!=","new")]}'/>
                                <!--<field name="workcenter_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>-->
                                <field name="process_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>
                                <!--<field name="workorder_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>-->
                                <field name="production_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>
                            </group>
                            <group>
                                <field name="company_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>
                                <field name="date" attrs='{"readonly":["|",("state","!=","new")]}'/>
                                <field name="report_date" attrs='{"invisible":["|",("is_report_date","!=",True)]}' />
                            </group>
                        </group>
                    </page>
                    <page string="Export/Import">
                        <group>
                            <group>
                                <separator string="Export"/>
                                <button string="Export" name="button_export" type="object" states="draft,confirmed,done" class="btn-info"/>
                            </group>
                            <group>
                                <separator string="Import"/>
                                <button string="Import" name="button_import" type="object"
                                    states="draft" class="btn-success oe_edit_only"/>
                                <field name="upload_file" filename ="file_name" string="CSV File" attrs='{"readonly":[("state","in",["confirmed","done"])]}'/>
                                <field name="file_name" invisible ="1"/>
                            </group>
                        </group>
                    </page>
                    <page name="stock_move" string="Stock Move" attrs="{'invisible':[('type','not in',['input','output'])]}">
                        <field name="move_lines" readonly="1">
                            <tree create="false" delete="false">
                                <field name="state" invisible="1"/>
                                <field name="mrp_data_id" invisible="1"/>
                                <field name="product_id"/>
                                <field name="product_uom_qty"/>
                                <field name="product_uom"/>
                                <field name="location_id" attrs="{'column_invisible':[('parent.type','not in',['input'])]}"/>
                                <field name="location_dest_id" attrs="{'column_invisible':[('parent.type','not in',['output'])]}"/>
                            </tree>
                        </field>
                    </page>
                    <!--<page name="stock_move_input" string="Stock Move" attrs="{'invisible':[('type','not in',['input'])]}">-->
                    <!--<field name="move_lines_input">-->
                    <!--<tree create="false" delete="false">-->
                    <!--<field name="state" invisible="1"/>-->
                    <!--<field name="mrp_data_id" invisible="1"/>-->
                    <!--<field name="product_id"/>-->
                    <!--<field name="product_uom_qty"/>-->
                    <!--<field name="product_uom"/>-->
                    <!--<field name="location_id"/>-->
                    <!--</tree>-->
                    <!--</field>-->
                    <!--</page>-->
                    <!--<page name="stock_move_output" string="Stock Move" attrs="{'invisible':[('type','not in',['output'])]}">-->
                    <!--<field name="move_lines_output">-->
                    <!--<tree create="false" delete="false">-->
                    <!--<field name="state" invisible="1"/>-->
                    <!--<field name="mrp_data_id" invisible="1"/>-->
                    <!--<field name="product_id"/>-->
                    <!--<field name="product_uom_qty"/>-->
                    <!--<field name="product_uom"/>-->
                    <!--<field name="location_dest_id"/>-->
                    <!--</tree>-->
                    <!--</field>-->
                    <!--</page>-->
                    <page string="Other">
                        <group>
                            <group>
                                <field name="picking_id" attrs='{"invisible":[("is_picking","=",False)]}'/>
                                <field name="reporter_user_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>
                                <field name="inspector_user_id" options='{"no_create":1,"no_open":1}' attrs='{"readonly":["|",("state","!=","new")]}'/>
                            </group>
                            <group>
                                <field name="confirm_date" readonly="1"/>
                                <field name="approve_date" readonly="1"/>
                            </group>
                        </group>
                    </page>
                </notebook>
                <field name="lines" attrs='{"readonly":[("state","in",["confirmed","done"])]}'
                    show_column_totals="1" show_row_totals = "1"
                    widget="x2many_2d_matrix" 
                    field_x_axis="gentime_line_id" 
                    field_y_axis="template_line_id" 
                    field_value="value" 
                    template_show_type="template_show_type"
                    on_change="0">
                    <tree limit="100000000" decoration-muted="item_type == 'header'" on_change="0">
                        <field name="mrp_data_id"/>
                        <field name="time_id"/>
                        <field name="item_id"/>
                        <field name="template_line_id"/>
                        <field name="gentime_line_id"/>
                        <field name="item_type" invisible="1"/>
                        <field name="time_type" invisible="1"/>
                        <field name="value"/>
                        <field name="workcenter_id" invisible="1"/>
                        <field name="workorder_id" invisible="1"/>
                        <field name="is_out_of_range" invisible="1"/>
                        <field name="is_readonly" invisible="1"/>
                        <field name="is_move" invisible="1"/>
                        <field name="model_name" invisible="1"/>
                        <field name="model_id" invisible="1"/>
                        <field name="template_id" invisible="1"/>
                        <field name="template_show_type" invisible="1"/>
                    </tree>
                </field>
                <!--</sheet>-->
            </form>
        </field>
    </record>

    <record id="action_data_qc" model="ir.actions.act_window">
        <field name="name">QC Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("type","=","qc")]</field>
        <field name="context">{"type":"qc"}</field>
    </record>


    <record id="action_data_input" model="ir.actions.act_window">
        <field name="name">Input Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("type","=","input")]</field>
        <field name="context">{"type":"input"}</field>
    </record>

    <record id="action_data_output" model="ir.actions.act_window">
        <field name="name">Output Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("type","=","output")]</field>
        <field name="context">{"type":"output"}</field>
    </record>

    <record id="action_data_qa" model="ir.actions.act_window">
        <field name="name">QA Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("type","=","qa")]</field>
        <field name="context">{"type":"qa"}</field>
    </record>

    <record id="action_data_dc" model="ir.actions.act_window">
        <field name="name">DC Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("type","=","dc")]</field>
        <field name="context">{"type":"dc"}</field>
    </record>

    <record id="action_mrp_data" model="ir.actions.act_window">
        <field name="name">MRP Data</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.data</field>
        <field name="domain">[("mrp_team_id","=",active_id)]</field>
    </record>

</odoo>
